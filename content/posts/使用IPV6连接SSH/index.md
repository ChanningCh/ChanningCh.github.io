---
title: "IPv6是什么"
date: 2024-12-30T13:43:42+08:00
description: "IPv6是什么"
tags: ["IPv6", "以太网"]
categories: ["Tools"]
comment: true
draft: false
---
## 前言

使用IPv6连接SSH, 这个问题可以很简单, 直接使用一条指令就可以完成

`ssh username@your_server_IPv6`

也可以很复杂, 想要知其所以然, 就继续往下看吧

## 什么是IPv6

### IPV4中的实现方法

先来看一下IPV4, 熟悉以太网结构的都知道, `IPv6`/`IPV4`这些都属与以太网架构中的IP层, 主要功能就是完成数据转发。

那么如何将数据 `frame` 准确的发给特定的设备呢? 我们都知道, 每个设备有一个 `MAC`地址, 这个是由 `MAC`层定的, 数据从 `MAC`层发出(一般是集成在ASIC中的), 会经过 `PHY`层传输, `PHY`不光是我们简单理解的物理介质, 还涉及到 **协商**/**打包** 等工作, 类似与快递公司, `PHY`出来可能还要经过其他物理介质, 例如 `transformer` 等, 扯远了, 不熟悉网络协议的小伙伴可以看看相关资料。

我们的 `MAC`地址是一个48bit长度的数据, 一般不会重复, 但是不好记忆和管理里, 以太网中的传输包括: **单播** / **组播** / **广播**, 多播场景用MAC是没法区分的, 但是 `IP`就不一样了, 可以根据 `子卡掩码`和 `IP`很容易确定多播的对象是谁。

但是, 我的 `IP`还是要和 `MAC`地址对应, 这就涉及到以太网中的 `ARP协议`

但是, IPV4的地址比较少, 有些特殊地址不能用, 例如 `xxx.xxx.xxx.255` 网段的广播地址, 某些用于机构或者大型网络, 给小型用户本来就不多了, 而且地址不是按人头分的! 老美这种互联网先发国家又拿走剩下绝大部分。我们一般用户常用的是 `192网段`和 `172网段`, 这都实际上都是被挑剩下的。

### IPv6有什么优点

回到IPv6, 那么第一个, 也是最浅显直观的优点就是

> 太多了, 根本用不完

`IPv6`的长度128bit !!! 比IPV4的32bit多太多了, 比 `MAC`地址的48bit都要多的多, 现在每个设备基本有一个独立的 `MAC`地址, 更何况IPv6了。

除此之外,

> IPv6地址配置、网络编号和网络路由更方便
>
> 寻址架构的优化, 可以完成三种不同类型的传输：**单播**、**任意播**和**组播**

### IPV6的地址结构

#### 组成

如果网络环境支持IP, 可以通过 `ifconfig`查看当前的IPV6地址。

{{< alert icon="tag" >}}
Tips: 如果你不确定当前网络环境是否支持IPV6, 可以点击[这里](https://test-IPv6.com "IPv6 test")测试
{{< /alert >}}

这个IPV6地址可能是这样:

```
inet 192.168.11.11  netmask 255.255.240.0  broadcast 192.168.11.11
        inet6 fe80:abcd:efff:f123:4567  prefixlen 64  scopeid 0x20 
```

也有可能是:

```
inet6 fe80::215:5dff:fed2:7d15  prefixlen 64  scopeid 0x20
```

其中:

* `inet6`后面的即是 IPV6地址, 各个字段的含义如下:

  再来看看具体的含义

  * 前缀: 要么你的单位通过网络策略阻断了与外界的 IPv6 通信，要么你看到的 IPv6 地址不是公网地址。任何以“::”“fc”“fd”或“fe”开头的地址都无法接入 IPv6 互联网
* `prefixlen`代表前缀长度, 有多个类型, 如下表, 例如常用的就是64bit的prefixlen, 也可以写成 `fe80:abcc:efff:f123::/64`

| 前缀长度 | 适用场景                                                                                          |
| -------- | ------------------------------------------------------------------------------------------------- |
| 32       | RIR/NIR（区域/国家互联网注册机构）分配给有 ASN 的运营商、互联网公司、大型企业。是地址最小分配单元 |
| 40       | 运营商向有多个（256个以内）站点和数据中心的大型企业分配的前缀                                     |
| 44       | 运营商向有多个（16个以内）站点和数据中心的中型企业分配的前缀                                      |
| 48       | 运营商向中小客户分配的常见前缀长度。或大中企业内一个站点的前缀                                    |
| 56       | 宽带运营商给家庭用户和小微企业分配的最小前缀长度（最大子网大小）                                  |
| 64       | 末端设备子网，/64 是很多协议硬性要求的（IPv6 无广播风暴风险）                                     |
| 127      | 路由器点对点链路，此处不是为了节约地址而是防止一种资源耗尽型攻击                                  |



尽管在规则允许下可以任意分配IPV6地址, 但一般会遵循某一规范, 例如[APNIC IPv6 地址分配方针](http://www.apnic.net/ipv6-guidelines)

在IPV6地址中, 为0的前导值可以省略, 例如: `fe80:0001:0002:0003:a299:9bff:fe18:50d1` 可以写成: `fe80:1:2:3:a299:9bff:fe18:50d1`

如果有一长串0, 可以全部省略, 并用 `::` 表示, 例如: `fe80:0000:0000:0000:0299:9bff:fe18:50d1` 可以写成: `fe80::299:9bff:fe18:50d1`

IPV6地址包括以下三种类型:

1. 全球单播地址 （GUA）/ 本地唯一地址（ULA）
2. 链路本地地址
3. 任播播地址

{{< alert icon="fire" cardColor="#e63946" textColor="#f1faee" >}}
警告: 不要暴露自己的 `全球单播地址(GUA)`/ `本地唯一地址(ULA)`, 否则路由器宣告(RA)报文会以多播形式明文传递出去, 彻彻底底的将你出卖, 别人就可以长驱直入控制你的设备了
{{< /alert >}}
