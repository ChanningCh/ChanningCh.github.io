---
title: "RS FEC算法"
date: 2024-12-27T20:57:26+08:00
draft: true
description: ""
---
3.1.1 FEC方案选取
目前业界常用的FEC技术类型包括:
 带内FEC: ITU-TG.707标准支持的带内FEC是利用SDH(Synchronous Digital Hierarchy)帧中的一部分比特用于装载FEC码的冗余码。其优点是不改变数据传输速率,但由于帧开销中可利用的比特数和帧长度有限,所以编码增益较低, 且需要基于SDH结构来封装实现, 并不适用于一般的测试场景。
 带外FEC: 即在数据帧尾额外插入冗余编码来实现。优点是更加灵活, 可根据实际的使用场景来调整编码的冗余度和纠错能力, 而不受SDH帧格式的限制。
 增强型FEC(EFEC): 是在带外FEC的基础上增加了级联信道编码等大增益编码技术, 主要应用于时延要求不严、编码增益要求特别高的通信场景。所谓级联信道编码, 即不仅对当前传输帧进行编码, 也会交织编码相邻帧, 可以实现跨frame间的纠错。级联码不仅具有较强的纠正突发错误、随机错误的能力, 提供更大的编码增益, 在特定的编码结构下, 基本可以达到纠错编码所给出的理论极限。但是, EFEC的编/解码过程比较复杂, 涉及的码型包括RS级联码、分组Turbo码和Goppa码等, 并且在交织编解码过程中引入了额外的延时。
在ITU-T G.975/G.709标准中既包含了支持带外基本FEC的协议, 也对EFEC中frame interleaving进行了规定(G.975 I.4)。FEC编码一般都基于Reed-Solomon编码及其变种实现, 表示为RS(n, k), 代表着通过对k 比特数据进行编码, 添加parity(长度为2t 比特)后组成n 比特长度的码型。通过Reed-Solomon编解码理论上最多可以实现t比特长度的纠错, 如下图所示。

例如, 行业内常用的几种标准中:
在ITU-T G.975/G.709标准中规定的RS(255,239)格式编码, 在每239比特的帧尾插入了16比特冗余码, 编码后长度为255。其编码冗余度约为7%[(255-239)/239 = 0.066]), 可以完成最高8比特的纠错, 编码增益约为6dB。
在IEEE标准的802.3bs/802.3cd协议中采用RS(544, 514)纠错算法, 在每544个比特长度的数据帧里最多可以修正15个比特错误, 预计可允许最大2.4E-4的原始误码率。
3.1.2 编解码实现方案
以一种编码方式为例, 使用RS(544, 514) (即KP4)的编码过程如下:

1. 64b/66b编码到256b/257b编码转换。PCS层将从MAC层接收的64b/66b编码的相邻4个Symbol重新编码成257b的数据符号
2. 加扰。对256b/257b编码的数据与PRBS扰码进行异或, 使得信号的整体频谱更接近随机信号的频谱分布
3. 同步符号插入。在每条PCS的链路上插入相应的Align Marker信息用于接收端的链路同步。
4. 符号分配和RS编码。在KP4的FEC编码过程中, 数据流以10280bit为单位进行编码。这些数据先分配成2个5140长度的编码字, 然后使用Reed-Solomon编码算法, 在每个编码字上增加30个10bit的校验符, 形成新的2个5440bit长度的编码字, 这两个编码字再进行交织并发送给PMA层
5. PMA层速率适配。经过编码后的PCS层根据链路速率进行适配和填充, 以达到目标速率, 并驱动PMA层进行信号传输。
6. 在接收端经过PMA -> PCS -> RS解码的逆过程, 如果每个数据帧里符号错误的数量超过15个, 则错误不可修正, 并会把错误的不可修正的数据帧丢掉。对于交织数据, 例如每两个544符号长度的数据帧会进行交织, 一旦其中一个里的错误数量超过15个, 无法完成纠错, 那这两个数据帧都会被一起丢掉。

采用KP4编码需要依赖的Xilinx “100G IEEE 802.3bj Reed-Solomon Forward Error Correction” IP, 但是目前没有license, 且没有官方release的文档和example(目前通过Xilinx Secure Site拿到了一部分资料)
采用ITU-T G.975/G.709标准实现可以依赖使用Xilinx 的G.709 FEC Encoder/Decoder, G.975.1 EFEC I.4 Encoder/Decoder和G.975.1 EFEC I.7 Encoder/Decoder这几个IP。这几个IP在算法实现上有细微区别, G.709中标准化了EFEC中的交织方法(frame interleave), 而G.975中没有。此外, G.975中的239 bits data symbol中需包含1bit 帧头。但是这几个IP都没有对应的Guide和example。
本测试中采用ITU-T G.975/G.709标准实现。
3.1.3 与预计指标的偏离度
下表中列出了理论上经过RS(255,239)纠错前/后的误码率值(离散误码):
BER before FEC BER after FEC
1.0E-3 8.6E-8
2.0E-4 2.0E-12
1.0E-4 5.0E-15
1.0E-5 6.3E-24
1.0E-6 6.4E-33
